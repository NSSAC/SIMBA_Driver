{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "$id": "https://raw.githubusercontent.com/NSSAC/SIMBA_driver/schema/schedule.json",
  "$vocabulary": {
    "https://json-schema.org/draft/2019-09/meta/applicator": true,
    "https://json-schema.org/draft/2019-09/meta/content": true,
    "https://json-schema.org/draft/2019-09/meta/core": true,
    "https://json-schema.org/draft/2019-09/meta/format": true,
    "https://json-schema.org/draft/2019-09/meta/validation": true,
    "https://json-schema.org/draft/2019-09/meta/meta-data": true
  },
  "definitions": {
    "schedule": {
      "$id": "schedule",
      "title": "Schedule",
      "$$target": [
        "#/definitions/schedule"
      ],
      "description": "The execution schedule of a model",
      "type": "object",
      "properties": {
        "priority": {
          "title": "Priority of Module Execution",
          "description": "Higher priority is executed first. Priorities must be unique.",
          "anyOf": [
            {
              "type": "number"
            },
            {
              "enum": [
                "-Infinity",
                "Infinity"
              ]
            }
          ]
        },
        "startTick": {
          "title": "Start Tick",
          "description": "The currentTick at which the module is executed first (default: -infinity).",
          "type": "number",
          "multipleOf": 1
        },
        "endTick": {
          "title": "End Tick",
          "description": "The targetTick for which the module is executed last (default: infinity).",
          "type": "number",
          "multipleOf": 1
        },
        "tickIncrement": {
          "title": "Tick Increment",
          "description": "The tick increment in which the module is executed (default: 1).",
          "type": "number",
          "multipleOf": 1,
          "minimum": 1
        }
      },
      "required": [
        "name",
        "priority"
      ]
    },
    "module": {
      "$id": "module",
      "title": "Module",
      "$$target": [
        "#/definitions/module"
      ],
      "description": "Description of module specific information",
      "allOf": [
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string"
            },
            "name": {
              "title": "Module Name",
              "description": "The name of the module.",
              "type": "string"
            },
            "command": {
              "title": "Module Command",
              "description": "The command to execute the module.",
              "type": "string"
            },
            "moduleData": {
              "title": "Module specific Data",
              "description": "Module specific data provided to the module upon execution.",
              "type": "object"
            }
          },
          "required": [
            "type",
            "name",
            "command"
          ]
        },
        {
          "oneOf": [
            {
              "$ref": "#/definitions/parslModule"
            }
          ]
        }
      ]
    },
    "parslModule": {
      "$id": "parslModule",
      "title": "Parsl Module",
      "$$target": [
        "#/definitions/parslModule"
      ],
      "description": "This describes module details required to execute a module through parsl (https://parsl.readthedocs.io/en/stable/index.html)",
      "type": "object",
      "properties": {
        "type": {
          "const": "parsl"
        },
        "executor": {
          "type": "object",
          "properties": {
            "type": {
              "description": "Executor: https://parsl.readthedocs.io/en/stable/stubs/parsl.executors.HighThroughputExecutor.html#parsl.executors.HighThroughputExecutor",
              "const": "HighThroughputExecutor"
            }
          },
          "required": [
            "type"
          ]
        },
        "provider": {
          "type": "object",
          "properties": {
            "type": {
              "description": "Slurm Provide: https://parsl.readthedocs.io/en/stable/stubs/parsl.providers.SlurmProvider.html#parsl.providers.SlurmProvider",
              "const": "SlurmProvider"
            }
          },
          "required": [
            "type"
          ]
        },
        "launcher": {
          "type": "object",
          "properties": {
            "type": {
              "description": "srun Launcher: https://parsl.readthedocs.io/en/stable/stubs/parsl.launchers.SrunLauncher.html#parsl.launchers.SrunLauncher",
              "const": "SrunLauncher"
            },
            "debug": {
              "type": "boolean",
              "default": true  
            },
            "overrides": {
              "type": "string",
              "default": ""
            }
          },
          "required": [
            "type"
          ]
        },
        "channel": {
          "type": "object"
        },
        "storageAccess": {
          "type": "object"
        }
      },
      "required": [
        "type"
      ]
    }
  },
  "title": "SIMBA Scheduler",
  "description": "The schema describes which and how modules are executed during each tick of the driver.",
  "type": "array",
  "items": {
    "allOf": [
      {
        "$ref": "#/definitions/schedule"
      },
      {
        "$ref": "#/definitions/module"
      }
    ]
}
}